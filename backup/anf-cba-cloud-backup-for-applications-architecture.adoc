---
sidebar: sidebar 
permalink: backup/anf-cba-cloud-backup-for-applications-architecture.html 
keywords: applications, anf, strategy, data protection, backup 
summary: Cloud Backup para aplicaciones es una solución SaaS que proporciona funcionalidades de protección de datos para aplicaciones que se ejecutan en el almacenamiento en cloud de NetApp. Cloud Backup para aplicaciones habilitado con NetApp BlueXP ofrece una protección eficiente, coherente con las aplicaciones y basada en políticas de SAP HANA en Azure NetApp Files. Cloud Backup para aplicaciones proporciona control y supervisión centralizados, a la vez que delegan la posibilidad de que los usuarios gestionen operaciones de backup y restauración específicas para aplicaciones. 
---
= Arquitectura Cloud Backup para aplicaciones
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:anf-cba-use-cases-and-value-of-accelerated-backup-and-cloning-operations_overview.html["Anterior: Información general de la arquitectura de backup en el cloud para aplicaciones."]

[role="lead"]
Cloud Backup para aplicaciones es una solución SaaS que proporciona funcionalidades de protección de datos para aplicaciones que se ejecutan en el almacenamiento en cloud de NetApp. Cloud Backup para aplicaciones habilitado con NetApp BlueXP ofrece una protección eficiente, coherente con las aplicaciones y basada en políticas de SAP HANA en Azure NetApp Files. Cloud Backup para aplicaciones proporciona control y supervisión centralizados, a la vez que delegan la posibilidad de que los usuarios gestionen operaciones de backup y restauración específicas para aplicaciones.

Cloud Backup para aplicaciones se ejecuta como SaaS dentro de NetApp BlueXP y aprovecha la estructura y la interfaz de usuario. El marco de trabajo de entorno de trabajo de BlueXP se utiliza para configurar y administrar las credenciales de Azure NetApp Files.

Se debe desplegar un conector BlueXP dentro de la vNet del cliente. La comunicación entre los componentes de SaaS de NetApp y el entorno del cliente se realiza en exclusiva mediante el conector. El conector ejecuta las operaciones de almacenamiento ANF mediante las API de gestión ANF.

El plugin de HANA proporciona la lógica específica de la base de datos HANA y debe implementarse en cada host HANA. El plugin de HANA se comunica con la base de datos HANA mediante el cliente hdbsql de HANA y una clave de almacenamiento de usuario. El conector BlueXP activa todas las operaciones de la base de datos.

image:anf-cba-image5.png["En esta imagen, se muestra la arquitectura básica de SaaS de NetApp en combinación con la red del cliente y una suscripción a Azure."]



== Cloud Backup para aplicaciones para SAP HANA en ANF



=== Descripción general de la solución

Cloud Backup para aplicación es compatible con las operaciones de backup basado en Snapshot para los siguientes componentes:

. *Volumen(s) de datos del sistema SAP HANA*.
. *Volumen(s) no data* de una base de datos SAP HANA. Por ejemplo, la `/hana/shared` Datos del servidor de aplicaciones SAP y/o del volumen.
. *Volumen(s) global no data* que no pertenecen a un sistema HANA específico. Por ejemplo, el directorio SAP transport `/usr/sap/trans`.


Las operaciones de backup de estos componentes incluyen lo siguiente:

* Backups programados o bajo demanda
* Scripts previos y posteriores opcionales
* Gestión de retención basada en políticas
+
** Para instantáneas a nivel de volumen ANF
** Dentro del catálogo de backup SAP HANA (para backups de volumen de datos HANA)




Los backups basados en archivos de SAP HANA se utilizan para comprobaciones de integridad de bloques de bases de datos y también se pueden ejecutar bajo demanda o como operaciones de backup programadas. La gestión de retención condicionada por políticas se realiza en el nivel del sistema de archivos y dentro del catálogo de backup HANA.

La gestión de retención del backup de registros de base de datos de HANA se realiza según la retención definida de backups de datos de la base de datos HANA (basados en snapshots o archivos).

CBA admite operaciones de restauración para todos los backups basados en Snapshot. Los backups basados en archivos solo se pueden restaurar mediante herramientas HANA nativas.

image:anf-cba-image6.png["Esta imagen muestra el backup y la restauración para un contenedor de base de datos multitenant del sistema HANA y volúmenes globales que no son datos."]



=== Operaciones de la solución

Los backups de datos de Snapshot se ejecutan con Cloud Backup para aplicaciones mediante la activación del punto de guardado de backup de base de datos de SAP HANA para que la copia de Snapshot, que se crea en la capa de almacenamiento, se base en una imagen consistente de la base de datos de SAP HANA. Consulte https://help.sap.com/docs/SAP_HANA_PLATFORM/6b94445c94ae495c83a19646e7c3fd56/b41a2823576f4726be649bc98e61d62c.html?q=sap%20hana%20snapshot%20backup["Guía de administración de los sistemas SAP"^] si quiere más información.

Para permitir un backup completo de todos los recursos relacionados con SAP HANA, Cloud Backup para aplicaciones también le permite realizar un backup de todos los volúmenes que no sean de datos con copias de Snapshot basadas en almacenamiento. Puede programar volúmenes que no sean de datos independientemente del backup de datos de la base de datos para habilitar políticas de retención y protección individuales.

SAP recomienda combinar backups de SnapVault basados en almacenamiento con un backup basado en archivos semanal para ejecutar una comprobación de la integridad de los bloques. Puede ejecutar la comprobación de integridad de bloque desde CBA. También se usan backups de comprobación de integridad de los bloques (basados en archivos) para descargar los backups a una segunda ubicación de almacenamiento.

Según sus políticas de retención configurables, Cloud Backup para aplicaciones gestiona el mantenimiento de los backups de datos, los backups de registros y el catálogo de backup de SAP HANA.

La siguiente figura resume la solución de backup.

image:anf-cba-image7.png["En esta figura se resume la solución de backup."]

Cuando se ejecuta un backup de Snapshot basado en el almacenamiento de volúmenes que no son de datos, Cloud Backup para aplicaciones realiza las siguientes tareas:

. Crea una copia snapshot de almacenamiento del volumen que no contiene datos.
. Elimina copias Snapshot de almacenamiento en función de la política de retención definida.


Al ejecutar un backup de Snapshot basado en el almacenamiento de la base de datos SAP HANA, el backup de cloud para aplicaciones realiza las siguientes tareas:

. Crea un punto de guardado de backup de SAP HANA para crear una imagen consistente en la capa de persistencia.
. Crea una copia snapshot de almacenamiento de los volúmenes de datos.
. Registra el backup de Snapshot de almacenamiento en el catálogo de backup de SAP HANA.
. Lanza el punto de guardado de backup de SAP HANA.
. Elimina copias Snapshot de almacenamiento en función de la política de retención definida.
. Elimina las entradas del catálogo de backup de SAP HANA en función de la política de retención definida.
. Cada vez que un backup de datos se eliminó manualmente o según la política de retención, Cloud Backup para aplicaciones elimina todos los backups de registros antiguos que eran del backup de datos más antiguo. Los backups de registros se eliminan en el sistema de archivos y en el catálogo de backup SAP HANA.




=== Versiones y configuraciones de SAP HANA compatibles

Cloud Backup para aplicaciones admite sistemas MDC de HANA con un único o múltiples inquilinos con las siguientes opciones de configuración:

* SAP HANA 2.0 SPS4 y posterior
* Sistemas de un solo host SAP HANA
* Los sistemas de varios hosts de SAP HANA, tal y como se describe en la sección link:anf-cba-backup-operations-with-hana-system-replication.html#backup-operations-with-hana-multiple-host-systems[""Operaciones de backup con sistemas de varios hosts de HANA""]
* El sistema SAP HANA configurado con la replicación de sistemas HANA (HSR) como se describe en la sección link:anf-cba-backup-operations-with-hana-system-replication.html["“Operaciones de copia de seguridad con replicación de sistemas HANA”"]




== Conceptos y prácticas recomendadas de Cloud Backup para aplicaciones



=== Estrategia de protección de datos

Antes de configurar Cloud Backup para aplicaciones, debe definir la estrategia de protección de datos en función de los requisitos de objetivo de tiempo de recuperación y objetivo de punto de recuperación de los distintos sistemas SAP.

Un enfoque común es definir tipos de sistemas, como sistemas de producción, desarrollo, pruebas o entornos de pruebas. Normalmente, todos los sistemas SAP del mismo tipo tienen los mismos parámetros de protección de datos.

Debe definir los siguientes parámetros:

* La frecuencia con la que se ejecuta un backup de Snapshot
* Durante cuánto tiempo se conserva un backup de Snapshot
* ¿Con qué frecuencia se ejecuta una comprobación de integridad de bloques (backups basados en archivos)
* Cuánto tiempo se conserva una copia de seguridad de comprobación de integridad de bloque (backups basados en archivos)


La siguiente tabla muestra un ejemplo de parámetros de protección de datos para los tipos de sistema producción, desarrollo y pruebas. Para el sistema de producción se ha definido una alta frecuencia de backups y se ejecutan backups semanales basados en archivos. Los sistemas de prueba y desarrollo tienen menores requisitos, y los backups Snapshot se programan con menos frecuencia.

|===
| Parámetros | Sistemas de producción | Sistemas de desarrollo | Pruebas de sistemas 


| Frecuencia de backups de Snapshot | Cada 4 horas | Cada 6 horas | Cada 12 horas 


| Retención de backup de Snapshot | 3 días | 3 días | 3 días 


| Frecuencia de comprobación de integridad de bloques | Una vez a la semana | Una vez a la semana | Una vez a la semana 


| Retención de comprobación de integridad de bloques | 4 semanas | 2 semanas | 1 semana 
|===
En la siguiente tabla, se muestran las políticas que deben configurarse para los parámetros de protección de datos para las operaciones de backup de Snapshot.

|===
| Parámetros | Política SnapshotEvery4h | Política SnapshotEvery6h | Política SnapshotEvery12h 


| Tipo de backup | Basado en Snapshot | Basado en Snapshot | Basado en Snapshot 


| Tipo de programación | Cada hora | Cada hora | Cada hora 


| Retención | Recuento = 18 | Recuento = 12 | Recuento = 3 


| Programa de backup | Cada 4 horas | Cada 6 horas | Cada 12 horas 
|===
En la siguiente tabla, se muestran las políticas que deben configurarse para los parámetros de protección de datos para las operaciones de backup basadas en archivos.

|===
| Parámetros | Archivo de políticas Based4Week | Archivo de políticas Based2Weeks | Archivo de directiva 1 Semana 


| Tipo de backup | Basado en archivos | Basado en archivos | Basado en archivos 


| Tipo de programación | Semanal | Semanal | Semanal 


| Retención | Recuento = 4 | Recuento = 2 | Recuento = 1 


| Programa de backup | Todos los domingos | Todos los domingos | Todos los domingos 
|===


== Operaciones de backup

SAP introdujo compatibilidad con backups de Snapshot en sistemas de varios inquilinos MDC con HANA 2.0 SPS4. En un sistema MDC de SAP HANA, la configuración de inquilinos no es necesariamente estática. Puede agregar o eliminar inquilinos. Cloud Backup para aplicaciones no puede confiar en la configuración que se detecta cuando la base de datos HANA se añade a Cloud Backup para aplicaciones. Cloud Backup para aplicaciones debe saber qué inquilinos están disponibles en el momento específico en que se ejecuta la operación de backup.

Por lo tanto, con cada operación de backup, el primer paso del flujo de trabajo es obtener la información del inquilino. El siguiente paso es la operación de backup de Snapshot. Este paso incluye el comando SQL para activar el punto de guardado de backup de HANA, el backup de Snapshot de ANF y el comando SQL para cerrar el punto de guardado de backup de HANA. Al usar el comando close, la base de datos de HANA actualiza el catálogo de backup de la base de datos del sistema y cada inquilino.


NOTE: SAP HANA no admite las operaciones de backup de Snapshot para sistemas MDC cuando se detienen uno o varios inquilinos.

Para la gestión de retención de backups de datos y la gestión del catálogo de backup de HANA, Cloud Backup para aplicaciones debe ejecutar las operaciones de eliminación de catálogo para la base de datos del sistema y todas las bases de datos de tenant que se identificaron en el primer paso. Del mismo modo para los backups de registros, el flujo de trabajo de backup de cloud para aplicaciones debe operar en cada inquilino que formaba parte de la operación de backup.

En la siguiente figura, se muestra información general sobre el flujo de trabajo de backup.

image:anf-cba-image8.png["En esta figura, se muestra información general sobre el flujo de trabajo de backup."]



=== Flujo de trabajo de backup para backups de Snapshot de la base de datos HANA

Cloud Backup para aplicaciones realiza un backup de la base de datos SAP HANA en el siguiente orden:

. Cloud Backup para aplicaciones lee la lista de inquilinos de la base de datos HANA.
. La información inquilino se almacena en los metadatos de Cloud Backup para aplicaciones para la operación de backup.
. Cloud Backup para aplicaciones activa un punto de guardado de backup sincronizado global de SAP HANA para crear una imagen de base de datos coherente en la capa de persistencia.
+

NOTE: Para un sistema de un solo inquilino de SAP HANA MDC, se crea un punto de guardado de backup global sincronizado para la base de datos del sistema y para cada base de datos de tenant con una única operación.

. Cloud Backup para aplicaciones crea copias Snapshot ANF para todos los volúmenes de datos configurados para el sistema HANA. Para una base de datos HANA de un solo host, solo hay un volumen de datos. Con una base de datos de varios hosts SAP HANA, hay varios volúmenes de datos.
. Cloud Backup para aplicaciones registra el backup de Snapshot en el catálogo de backup de SAP HANA.
. Cloud Backup para aplicaciones elimina el punto de guardado de backup de SAP HANA.
. Cloud Backup para aplicaciones elimina las copias Snapshot ANF y las entradas de backup en su base de datos, así como en el catálogo de backup SAP HANA, según la política de retención definida para los backups. Se realizan operaciones del catálogo de backup DE HANA para la base de datos del sistema y todos los inquilinos.
. Cloud Backup para aplicaciones elimina todos los backups de registros en el sistema de archivos y en el catálogo de backup de SAP HANA que son más antiguos que el backup de datos más antiguo identificado en el catálogo de backup de SAP HANA. Estas operaciones se realizan para la base de datos del sistema y todos los inquilinos.




=== Flujo de trabajo de backup para operaciones de comprobación de integridad de bloques

Cloud Backup para aplicaciones ejecuta la comprobación de integridad de bloques en la siguiente secuencia:

. Cloud Backup para aplicaciones lee la lista de inquilinos de la base de datos HANA.
. Cloud Backup para aplicaciones activa una operación de backup basada en archivos para la base de datos del sistema y cada inquilino.
. Cloud Backup para aplicaciones elimina los backups basados en archivos de su base de datos, en el sistema de archivos y en el catálogo de backup de SAP HANA según la política de retención definida para las operaciones de comprobación de integridad de bloque. La eliminación de backup en el sistema de archivos y las operaciones de catálogo de backup de HANA se realizan para la base de datos del sistema y todos los inquilinos.
. Cloud Backup para aplicaciones elimina todos los backups de registros en el sistema de archivos y en el catálogo de backup de SAP HANA que son más antiguos que el backup de datos más antiguo identificado en el catálogo de backup de SAP HANA. Estas operaciones se realizan para la base de datos del sistema y todos los inquilinos.




== Gestión de retención de backup y mantenimiento de backups de datos y registros

La gestión de retención de backup de datos y el mantenimiento de backup de registros se pueden dividir en cuatro áreas principales, incluida la gestión de retención de las siguientes:

* Backups Snapshot
* Backups basados en archivos
* Backups de datos en el catálogo de backup de SAP HANA
* Los backups de registro en el catálogo de backup de SAP HANA y el sistema de archivos


En la siguiente figura, se proporciona información general sobre los diferentes flujos de trabajo y las dependencias de cada operación. En las siguientes secciones se describen detalladamente las diferentes operaciones.

image:anf-cba-image9.png["En esta figura, se proporciona información general sobre los diferentes flujos de trabajo y las dependencias de cada operación."]



=== La gestión de retención de backups de Snapshot

Cloud Backup para aplicaciones gestiona el mantenimiento de los backups de bases de datos SAP HANA y los backups de volúmenes sin datos eliminando copias Snapshot en el almacenamiento y en el repositorio de Cloud Backup para aplicaciones según la retención definida en la política de backup de cloud para aplicaciones.

La lógica de gestión de retención se ejecuta con cada flujo de trabajo de backup en Cloud Backup para aplicaciones.

También puede eliminar backups de snapshots manualmente en Cloud Backup para aplicaciones.



=== Gestión de retención de backups basados en archivos

Cloud Backup para aplicaciones gestiona el mantenimiento de los backups basados en archivos eliminando los backups en el sistema de archivos según la retención definida en la política de backup de Cloud Backup para aplicaciones.

La lógica de gestión de retención se ejecuta con cada flujo de trabajo de backup en Cloud Backup para aplicaciones.



=== Gestión de retención de backups de datos dentro del catálogo de backup de SAP HANA

Cuando Cloud Backup para aplicaciones elimina cualquier backup (Snapshot o basado en archivos), este backup de datos también se elimina en el catálogo de backup de SAP HANA.



=== Gestión de retención de backups de registros

La base de datos SAP HANA crea automáticamente backups de registro. Este backup de registro ejecuta crear archivos de backup para cada servicio SAP HANA individual en un directorio de backup configurado en SAP HANA.

Los backups de registros más antiguos que los backups de datos más antiguos correctos ya no son necesarios para la recuperación futura y, por lo tanto, se pueden eliminar.

Cloud Backup para aplicaciones gestiona el mantenimiento de los backups de archivos de registro en el nivel de sistema de archivos y en el catálogo de backup SAP HANA mediante la ejecución de los siguientes pasos:

* Cloud Backup para aplicaciones lee el catálogo de backup de SAP HANA para obtener el ID de backup del backup más antiguo basado en archivos o backup de Snapshot correcto.
* Cloud Backup para aplicaciones elimina todos los backups de registros en el catálogo SAP HANA y en el sistema de archivos que son anteriores a este ID de backup.



NOTE: Cloud Backup para aplicaciones solo gestiona el mantenimiento de los backups creados con Cloud Backup para aplicaciones. Si cualquier backup de datos adicional se crea fuera de Cloud Backup para aplicaciones, debe asegurarse de que los backups de datos se eliminen del catálogo de backup. Si un backup de datos de este tipo no se elimina manualmente del catálogo de backups, puede convertirse en el backup de datos más antiguo y los backups de registros más antiguos no se eliminan hasta que este backup de datos se elimine.


NOTE: El mantenimiento del backup de registros está habilitado de forma predeterminada, pero se puede deshabilitar a nivel del host del plugin de HANA. Edite el `hana.property` archivo `/opt/NetApp/snapcenter/scc/etc`. Incluido el parámetro `LOG_CLEANUP_DISABLE = Y` en la `hana.property` el archivo de configuración deshabilita el mantenimiento de la copia de seguridad de registros. Si el archivo no existe, debe crearlo.



== Habilite la comunicación segura con la base de datos de HANA

Si la base de datos HANA está configurada con comunicación segura, el `hdbsql` El comando que ejecuta CBA debe utilizar opciones adicionales de la línea de comandos. Esto se puede lograr usando un script contenedor que llama `hdbsql` con las opciones necesarias.


NOTE: Existen varias opciones para configurar la comunicación SSL. En los siguientes ejemplos, la configuración de cliente más simple se describe utilizando la opción de línea de comandos, donde no se realiza ninguna validación de certificado de servidor. Si se requiere la validación de certificados en el servidor o en el cliente, se necesitan opciones de línea de comandos hdbsql distintas y debe configurar el entorno PSE de acuerdo con lo descrito en la Guía de seguridad de SAP HANA.

En lugar de configurar el `hdbsql` ejecutable en la `hana.properties` archivos, agregue el script contenedor. En el archivo `/opt/NetApp/snapcenter/scc/etc/hana.properties`, debe agregar el siguiente contenido. Si el archivo no existe, debe crearlo.

Este ejemplo es para un sistema HANA con SID=SM1 y Instance Number=12.

....
HANA_HDBSQL_CMD = /usr/sap/SM1/HDB12/exe/hdbsqls
....
La secuencia de comandos contenedora `hdbsqls` llamadas `hdbsql` con las opciones de línea de comandos necesarias.

....
#/bin/bash
/usr/sap/SM1/HDB12/exe/hdbsql -e -ssltrustcert $*
....


== Requisitos de capacidad para backups de Snapshot

Debe tener en cuenta la tasa de cambio de bloque más alta en la capa de almacenamiento en relación con la tasa de cambio con las bases de datos tradicionales. Debido al proceso de combinación de tablas HANA del almacén de columnas, la tabla completa se escribe en el disco, no solo en los datos modificados de la tabla.

Los datos de nuestra base de clientes muestran una tasa de cambio diaria entre el 20 % y el 50 % al día si se realizan varios backups de Snapshot durante el día.

link:anf-cba-overview-of-installation-and-configuration-steps.html["Siguiente: Descripción general de los pasos de instalación y configuración."]
