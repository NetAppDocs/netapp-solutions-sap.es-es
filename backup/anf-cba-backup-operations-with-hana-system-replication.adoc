---
sidebar: sidebar 
permalink: backup/anf-cba-backup-operations-with-hana-system-replication.html 
keywords: system replication, cba, hsr, multiple host, standby host 
summary: En esta sección se describe cómo realizar operaciones de backup con la replicación del sistema HANA. 
---
= Operaciones de backup con la replicación de sistemas HANA
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:anf-cba-restore-and-recovery-from-snapshot-backup.html["Anterior: Restauración y recuperación desde un backup de Snapshot."]



== Backups de Storage Snapshot y replicación de sistemas HANA

Las operaciones de backup siempre se realizan en el host SAP HANA principal, ya que los comandos de SQL necesarios para la operación de backup no pueden realizarse en el host SAP HANA secundario.

Para las operaciones de backup de SAP HANA, los hosts SAP HANA primarios y secundarios son una entidad única. Comparten el mismo catálogo de backup SAP HANA y utilizan los backups para la restauración y la recuperación, independientemente de si el backup se creó en el host SAP HANA primario o secundario.

La capacidad de utilizar cualquier backup para restaurar y reenviar recuperaciones mediante backups de registros de ambos hosts requiere una ubicación de backup de registros compartidos a la que ambos hosts puedan acceder. NetApp recomienda la utilización de un volumen de almacenamiento compartido. Sin embargo, también debe separar el destino de la copia de seguridad de registro en subdirectorios dentro del volumen compartido.

Cada host SAP HANA tiene su propio volumen de almacenamiento. Cuando se utiliza una copia de Snapshot basada en el almacenamiento para realizar un backup, se crea una copia de Snapshot coherente con la base de datos en el volumen de almacenamiento del host SAP HANA principal.

image:anf-cba-image102.png["En esta figura, se muestra cómo se crea una copia Snapshot coherente con la base de datos en el volumen de almacenamiento del host SAP HANA principal."]

Cuando se realiza una conmutación por error al host 2, el host 2 se convierte en el host SAP HANA principal, los backups ahora se ejecutan en el host 2 y los backups de Snapshot se crean en el volumen de almacenamiento del host 2.

El backup creado en el host 2 se puede restaurar directamente en la capa de almacenamiento. Si se debe usar un backup creado en el host 1, se debe copiar el backup del volumen de almacenamiento del host 1 al volumen de almacenamiento del host 2. La recuperación futura utiliza los backups de registros de ambos hosts.

image:anf-cba-image103.png["En esta figura, se muestra cómo la recuperación futura utiliza los backups de registros de ambos hosts."]



== Operaciones de backup con sistemas HANA habilitados para CBA y HSR

Como comentaremos brevemente en la sección de envidia, debe tener en cuenta algo especial en las operaciones de backup con sistemas HANA con HSR.

* Una operación de backup solo se puede ejecutar en el host HANA principal. Por lo tanto, CBA debe conocer qué host es actualmente el primario al ejecutar una operación de backup.
+
** Las sentencias SQL de backup deben ejecutarse en el host primario actual.
** Un backup de instantánea solo se debe realizar en el volumen de datos de host primario, ya que el volumen de datos del host secundario no tiene ningún estado consistente y, por lo tanto, no se puede utilizar para una operación de restauración y recuperación.


* La gestión de retención de los backups de Snapshot debe realizarse en ambos hosts. Por ejemplo, cuando se ejecuta una conmutación por error al host secundario, los backups del host primario anterior también deben eliminarse según la retención definida en todas las capas, CBA, el volumen ANF y el catálogo de backup HANA. Si no se eliminan backups de registros antiguos basados en la gestión de retención de backup de registros, se bloquea debido a los backups de datos antiguos.


En CBA, ambos hosts HANA, el primario y el secundario, están configurados igual que los sistemas HANA normales, como se muestra en la siguiente figura. La única diferencia durante la configuración es una casilla de verificación que está marcada para indicar a CBA que este sistema HANA forma parte de un buque de ralación HSR. CBA lee el estado HSR de los hosts y puede averiguar qué hosts pertenecen juntos y qué host es principal o secundario. En el caso de CBA internamente, estos dos hosts se tratan como una entidad única, donde un backup solo se ejecuta en el host primario actual y la gestión de retención se realiza en ambos hosts.


NOTE: CBA sólo admite HSR para una configuración de dos hosts.

image:anf-cba-image104.png["Esta figura muestra cómo CBA sólo admite HSR para una configuración de dos hosts."]



== Descripción general de los pasos de instalación y configuración

Hay algunas diferencias menores en los pasos de configuración necesarios para un sistema HANA habilitado para HSR. En esta sección, solo destacamos las diferencias en comparación con los pasos de configuración estándar ya descritos.

. Cree un usuario de backup en la base de datos del sistema HANA en el host HSR principal.
. Añada el host principal y configure el sistema HANA en Cloud Backup para aplicaciones.
+
.. Seleccione *HANA System Replication* durante la configuración.
+
image:anf-cba-image105.png["Captura de pantalla del paso que se está realizando."]

.. Añada el espacio de almacenamiento del host primario.
+
image:anf-cba-image106.png["Captura de pantalla del paso que se está realizando."]



. El nuevo sistema HANA ahora se incluye con un icono HSR.
+
image:anf-cba-image107.png["Captura de pantalla del paso que se está realizando."]

. Añada un host secundario y configure el sistema HANA en Cloud Backup para aplicaciones.
+
.. Seleccione *HANA System Replication* durante la configuración.
+
image:anf-cba-image108.png["Captura de pantalla del paso que se está realizando."]

.. Añada el espacio de almacenamiento del host secundario.
+
image:anf-cba-image109.png["Captura de pantalla del paso que se está realizando."]

+
Ambos sistemas se enumeran ahora con el icono HSR.

+
image:anf-cba-image110.png["Captura de pantalla del paso que se está realizando."]



. Añada políticas de backup al sistema HANA primario y secundario.
+

NOTE: Debe añadir las mismas políticas a ambos sistemas, ya que la gestión de la retención se realiza en ambos hosts HANA.



Ahora, los backups se ejecutan en función de las políticas definidas. CBA siempre activa la operación de backup de Snapshot en el host HANA principal.

link:anf-cba-backup-operations-with-hana-multiple-host-systems.html["Siguiente: Operaciones de backup con sistemas HANA de varios hosts."]
